<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer">
  <title></title>
  <style>
*{
margin: 0;
padding: 0;
box-sizing: border-box;
}

form, input[type="radio"],#loader,#bb{
  display: none;
}

#top {
  width: 100vw;
  height: auto;
  position: sticky;
  top: 0;
  display: flex;
  padding: 5% 0 5% 0;
  color: white;
  background-image: linear-gradient(to right, navy 0%, #0072ff 51%, navy 100%);
  background-size: 200% auto;
background-position: left center;
  box-shadow: 1px 1px 4px rgba(0, 0, 0, .6);
  z-index: 3;
}

#top p {
  width: 100%;
  font-size: larger;
  font-weight: bold;
  margin-left: 5%;
}

#top i {
  margin-right: 7%;
}

.dropdown-box {
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 15px 10px;
  width: 90%;
  position: relative;
  left: 5%;
  cursor: pointer;
  text-align: center;
}

.box-heading {
  position: absolute;
  left: 12px;
  top: 0;
  transform: translateY(20px);
  padding: 0 6px;
  font-size: small;
  font-weight: bold;
  color: #333;
  background: white;
  opacity: 0;
  transition: transform 0.2s ease, opacity 0.2s ease;
}

.box-heading.show {
  transform: translateY(-12px);
  opacity: 1;
}

.box-text {
  font-size: medium;
  color: #000;
}

.dropdown-content {
  max-height: 0;
  overflow: hidden;
  opacity: 0;
  transform: translateY(-10px);
  transition: max-height 0.2s ease, opacity 0.2s ease, transform 0.2s ease;
  border-radius: 4px;
  background-color: #fff;
  width: 90%;
  position: absolute;
  left: 5%;
  z-index: 999;
  box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23);
}

.dropdown-content.show {
  max-height: 500px;
  opacity: 1;
  transform: translateY(0);
}

.dropdown-content p {
  display: block;
  padding: 10px;
  text-decoration: none;
  color: #000;
}

.dropdown-content p:hover {
  background-color: #f1f1f1;
}

.data-box {
  width: 100%;
  padding: 14px 14px;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: large;
  cursor: pointer;
  transition: background 0.2s;
}

.data-box:hover {
  background: #e0e0e0;
}

#Change{
  position: relative;
width: 100%;
height: 80vh;
border-radius: 8px;
}

#Change button {
  position: sticky;
  bottom: 0;
  padding: 10px 20px;
  margin: 5px;
  font-weight: bold;
  cursor: pointer;
}

form {
  position: absolute;
  margin: 2px;
  margin-bottom: 20px;
  padding: 10px;
  font-size: 5.7vw;
  margin: auto;
  width: 100%;
  height: auto;
  top: 0;
  left: 0;
  box-sizing: border-box;
  transition: transform 0.4s ease, opacity 0.4s ease;
}

form p {
  display: flex;
  flex-direction: row;
}

form label {
  position: relative;
  width: 90%;
  display: inline-flex;
  flex-direction: row;
  margin-top: 3.5vw;
  border-radius: 6px;
  background-color: white;
  color: #0d0d0d;
  padding: .5vw 0 .5vw 3vw;
}

form input[type="radio"] {
  position: relative;
  top: 2vw;
  width: 7vw;
  height: 7vw;
  accent-color: red;
  margin-top: 1vw;
}

#loader{
  position: fixed;
  top: 0;
  left: 0;height: 100vh;
  width: 100vw;
  background: rgba(255, 255, 255, 0.8);
  z-index: 9999;
  justify-content: center;
  align-items: center;
  font-size: 24px;
  font-weight: bold;
  color: navy;
}

#bb{
  width: 100%;
  height: auto;
  position: absolute;
  bottom: 2px;
  gap: 23px;
  justify-content: center;
  align-items: center;
}

#bb button {
padding: 10px 25px;
font-size: xx-large;
font-weight: 600;
border: none;
border-radius: 8px;
background: linear-gradient(to bottom right, #2b2b2b, #000000);
box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1),0 4px 10px rgba(0, 0, 0, 0.3);
color: white;
}

#Sc{
  display: none;
  position: absolute;
  gap: 20px;
  left: 5%;
}

#Sc button{
  font-size: large;
  font-weight: bold;
  padding: 5px 5px;
  border: 1px solid #2b2b2b;
  border-radius: 5px;
  outline: none;
  background: linear-gradient(to bottom right, #2b2b2b, #000000);
color: white;
}

#sn{
  width: 80%;
  height: auto;
  font-size: large;
  padding: 2px 0 2px 5px;
  outline: none;
  border: 1px solid #ddd;
  border-radius: 5px;
}

#sn:focus{
  border-color: green;
  box-shadow: inset 0 1px 4px #eee, 0 0 10px 2px #eee;
}
}
  </style>
</head>

<body>
<div id="top">
  <p><i class='fas fa-arrow-left' onclick="goBack();"></i><span id="PH">Chameleon</span></p>
</div><br />
  <div id="rbox" class="page">
  <div class="dropdown-box" onclick="toggleDropdown()" id="dropdownBox">
<div class="box-heading" id="boxHeading">Subject</div>
<div class="box-text" id="boxText">Select Option ▼</div>
  </div>
  
  <div class="dropdown-content" id="dropdownMenu">
<p onclick="selectOption(event, 'COPA THEORY')">COPA THEORY</p>
<p onclick="selectOption(event, 'EMPLOYABILITY SKILL')">EMPLOYABILITY SKILL</p>
  </div>
  
  <div id="outputBoxes" style="margin: 20px 5%; display: flex; gap: 10px; flex-wrap: wrap;"></div>
</div>
<div id="Sc">
  <input type="number" id="sn" value="" />
  <button onclick="go()">Go</button></div><br /><br /><br />

<div id="Change" class="page"></div>
<div id="bb">
<br /><button onclick="prev()">Prev</button> <button onclick="next()">Next</button>
  </div>
<div id="loader">
  Loading...
</div>

<script>
var first = 0;
var second = 0;
var mcqIds = [];

const chapterData = {
  "COPA THEORY": ["Safe Working Practice", "Introduction to Computer components"],
  "EMPLOYABILITY SKILL": ["English Literacy", "IT Literacy"]
};

const valueMap = {
  "Safe Working Practice": [1, 50],
  "Introduction to Computer components": [5, 11],
  "English Literacy": [12, 20],
  "IT Literacy": [21, 30]
};

let headingChanged = false;

function toggleDropdown() {
  document.getElementById("dropdownMenu").classList.toggle("show");
}

function selectOption(event, optionText) {
  event.stopPropagation();
  const heading = document.getElementById("boxHeading");
  const boxText = document.getElementById("boxText");

  if (!headingChanged) {
heading.textContent = boxText.textContent;
heading.classList.add("show");
headingChanged = true;
  }

  boxText.textContent = optionText + " ▼";
  document.getElementById("dropdownMenu").classList.remove("show");

  const container = document.getElementById("outputBoxes");
  container.innerHTML = ""; // clear old boxes

  if (chapterData[optionText]) {
chapterData[optionText].forEach(value => {
const box = document.createElement("div");
box.className = "data-box";
box.textContent = value;
box.onclick = () => {
if (valueMap[value]) {
  [first, second] = valueMap[value];
  goToPage('Change');
  loadSheetData();
mcqIds = Array.from({ length: second - first + 1 }, (_, i) => i + first);
} else {
  alert("No mapped values found");
}
};
container.appendChild(box);
});
  }
}

window.onclick = function(event) {
if (!event.target.closest('.dropdown-box') && !event.target.closest('#dropdownMenu')) {
document.getElementById("dropdownMenu").classList.remove("show");
  }
};

   //history
function goBack() {
  document.getElementById("Change").innerHTML="";
  document.getElementById("Sc").style.display="none";
  document.getElementById("PH").textContent="Chameleon";
  document.getElementById("bb").style.display="none";
history.back();
}

function goToPage(pageName) {
// Hide all pages using style.display
document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
// Show selected page
const target = document.getElementById(pageName);
if(pageName='Change'){
  document.getElementById("bb").style.display="flex";
  document.getElementById("Sc").style.display="flex";
}
if (target) {
   target.style.display = 'block';
history.pushState({ page: pageName }, '', `?page=${pageName}`);
}
}

  // On browser back/forward
window.onpopstate = function(event) {
const page = event.state?.page || 'rbox';
 document.getElementById("PH").textContent="Chameleon";
 document.getElementById("loader").style.display = "none";
if (pageName = 'Change') {
  document.getElementById("bb").style.display = "none";
  document.getElementById("Sc").style.display="none";

}
   showPage(page);
};

// Show page by display style
function showPage(pageName) {
  document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
  const target = document.getElementById(pageName);
if (target){
  target.style.display = 'block';
}}

// On load, display correct page
window.onload = function() {
const params = new URLSearchParams(location.search);
const page = params.get('page') || 'rbox';
showPage(page);
};

  //Load Mcq
const sheetID = "1Et-kPikwO3r0tM9d1EcHnqs2VWOFhPHW2Dm77tTPg70"; // Replace with your sheet ID
const gid = "0"; // First sheet

async function loadSheetData() {
  document.getElementById("Change").innerHTML = "";
  showLoader();
  currentIndex = 0;
const url = `https://docs.google.com/spreadsheets/d/${sheetID}/export?format=csv&gid=${gid}`;
  const res = await fetch(url);
  const text = await res.text();
  hideLoader();
  const rows = text.trim().split("\n").map(r => r.split(","));

  const headers = rows[0];
  const data = rows.slice(1);

  const qd = data.map(row => ({
no: row[0],
q: row[1],
op1: row[2],
op2: row[3],
op3: row[4],
op4: row[5],
ans: row[6]
  }));

  // Show only question numbers between first and second
  const filtered = qd.filter(q => {
const num = parseInt(q.no);
return num >= first && num <= second;
  })
  
  displayQuestions(filtered);
}

function displayQuestions(qd) {
for (let i = 0; i < qd.length; i++) {
document.getElementById("Change").innerHTML += `
<form id="x${qd[i].no}">
<p>(${i+1}) &nbsp;${qd[i].q}</p>
<input type="radio" name="${qd[i].no}" id="${qd[i].no}1">
<label for="${qd[i].no}1">A. ${qd[i].op1}</label><br />

<input type="radio" name="${qd[i].no}" id="${qd[i].no}2">
<label for="${qd[i].no}2">B. ${qd[i].op2}</label><br />

<input type="radio" name="${qd[i].no}" id="${qd[i].no}3">
<label for="${qd[i].no}3">C. ${qd[i].op3}</label><br />

<input type="radio" name="${qd[i].no}" id="${qd[i].no}4">
<label for="${qd[i].no}4">D. ${qd[i].op4}</label><br /><br />

<p class="ans" id="an${qd[i].no}">Answer: ${qd[i].ans}</p></form>`;
}
const el = document.getElementById("rbox");

  if (qd.length > 0 && window.getComputedStyle(el).display === "none") {
  updateQuestionIndicator(); 
  document.getElementById("x"+first).style.display = "block";
}
}

// slide to change
let currentIndex = 0;
let transitioning = false;

function showSlide(newIndex) {
  if (newIndex < 0 || newIndex >= mcqIds.length || newIndex === currentIndex || transitioning) return;

  transitioning = true;

  const currentId = mcqIds[currentIndex];
  const nextId = mcqIds[newIndex];

  const currentEl = document.getElementById('x' + currentId);
  const nextEl = document.getElementById('x' + nextId);
  const direction = newIndex > currentIndex ? 1 : -1;

  // Reset nextEl
nextEl.style.transition = 'none';
  nextEl.style.transform = `translateX(${100 * direction}%)`;
  nextEl.style.opacity = '0';
  nextEl.style.display = 'block';

  // Force reflow to apply initial state before transition
  nextEl.offsetWidth; // <- this line is CRUCIAL

  // Now apply transition
  nextEl.style.transition = 'transform 0.4s ease, opacity 0.4s ease';
  currentEl.style.transition = 'transform 0.4s ease, opacity 0.4s ease';

  // Start transitions
  currentEl.style.transform = `translateX(${-100 * direction}%)`;
  currentEl.style.opacity = '0';
  nextEl.style.transform = 'translateX(0)';
  nextEl.style.opacity = '1';

  // End transition cleanup
  setTimeout(() => {
    currentEl.style.display = 'none';
    currentEl.style.transform = 'translateX(0)';
    currentEl.style.opacity = '1';

    currentIndex = newIndex;
    transitioning = false;
    updateQuestionIndicator();
  }, 400);
}

function next() {
  showSlide(currentIndex + 1);
}

function prev() {
  showSlide(currentIndex - 1);
}

// Numbers
function updateQuestionIndicator() {
const indicator = document.getElementById("PH");
if (indicator && mcqIds.length > 0) {
indicator.textContent = `${currentIndex + 1} out of  ${mcqIds.length}`;
  }
}

//loader
function showLoader() {
  document.getElementById("loader").style.display = "flex";
}

function hideLoader() {
  document.getElementById("loader").style.display = "none";
}

const container = document.getElementById("Change");
let touchStartX = 0;
let touchEndX = 0;

container.addEventListener("touchstart", function (e) {
  touchStartX = e.changedTouches[0].screenX;
}, { passive: true });

container.addEventListener("touchmove", function (e) {
  // Prevent vertical scroll when swiping horizontally
  const dx = e.changedTouches[0].screenX - touchStartX;
  if (Math.abs(dx) > 10) {
    e.preventDefault(); // stop page from scrolling
  }
}, { passive: false });

container.addEventListener("touchend", function (e) {
  touchEndX = e.changedTouches[0].screenX;
  handleSwipe();
}, { passive: true });

function handleSwipe() {
  const dx = touchEndX - touchStartX;
  if (dx < -50) next();   // Swipe left
  if (dx > 50) prev();    // Swipe right
}

function go() {
  const input = document.getElementById("sn");
  const sn = parseInt(input.value);

  if (isNaN(sn) || sn < 1 || sn > mcqIds.length) {
    alert("Invalid question number");
    input.value = ""; // Clear input
    return;
  }
  const index = sn - 1;
  showSlide(index);
  input.value = ""; // Clear input after valid entry
}



</script>
</body>

</html>
